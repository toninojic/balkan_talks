document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("#load-more-button").forEach(function (loadMoreBtn) {
        loadMoreBtn.addEventListener("click", function () {
            let parentWrapper = loadMoreBtn.parentElement;
            let postContainer = parentWrapper.querySelector(".post-container");

            if (!postContainer) {
                console.error("Post container not found near load more button.");
                return;
            }

            let offset = parseInt(loadMoreBtn.getAttribute("data-offset"));
            let category = loadMoreBtn.getAttribute("data-category") || null;
            let tag = loadMoreBtn.getAttribute("data-tag") || null;
            let postsPerPage = parseInt(loadMoreBtn.getAttribute("data-posts-per-page")) || 6;

            fetch(data.ajax_url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"
                },
                body: new URLSearchParams({
                    action: "load_more_posts",
                    security: data.nonce,
                    offset: offset,
                    category: category,
                    tag: tag,
                    posts_per_page: postsPerPage
                })
            })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        if (result.data.trim() !== "") {
                            postContainer.innerHTML += result.data;
                            loadMoreBtn.setAttribute("data-offset", offset + postsPerPage);
                        } else {
                            loadMoreBtn.textContent = "No more posts";
                            loadMoreBtn.disabled = true;
                        }
                    } else {
                        console.error("Error while loading posts.");
                    }
                })
                .catch(error => {
                    console.error("Error while sending request:", error);
                });
        });
    });
});

// Hamburger menu toggle
document.addEventListener("DOMContentLoaded", function () {
    let hamburgerMenu = document.querySelector(".hamburger-menu");
    let mainMenu = document.querySelector("#main-menu");

    if (hamburgerMenu && mainMenu) {
        hamburgerMenu.addEventListener("click", function () {
            mainMenu.classList.toggle("active");
        });
    }

    let hamburgerIcon = document.querySelector(".hamburger");
    if (hamburgerIcon) {
        hamburgerIcon.addEventListener("click", function () {
            hamburgerIcon.classList.toggle("is-active");
        });
    }
});

document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("in-content-search");
    const content = document.getElementById("searchable-content");

    if (searchInput && content) {
        searchInput.addEventListener("input", function () {
            const keyword = this.value.toLowerCase();
            const children = content.querySelectorAll("p, li, h2, h3, h4");

            children.forEach(el => {
                const text = el.textContent.toLowerCase();
                el.style.display = text.includes(keyword) ? "block" : "none";
            });
        });
    }
});